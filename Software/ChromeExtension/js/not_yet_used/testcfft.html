<html>
    <head>
    </head>
    <body>
        <div>FREQUENCY DOMAIN TEST, CHECK CONSOLE FOR RESULT</div>
        <div id="freq"></div>
        Sine Wave Graph.
        <div id="chart"></div>
        Homebrew FFT graph. Definitely funky.
        <div id="homebrewfft"></div>
        FFT.JS result. The Frequency distribution is not correct however.
        <div id="fftchart"></div>
        <!--- DSP.JS result.
        <div id="dspchart"></div> --->
        <script src="cfft.js"></script>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script src="complex_array.js"></script>
        <script src="fft.js"></script>
        
        <script>
            var sineWave = [];
            var t = [];
            var fs = 8192; // Sample rate
            var freq = 256; // Generate this frequency
            var increment = 1/fs; //x-axis time increment based on sample rate
            var sec = 1; //Seconds of data to generate 
            document.getElementById("freq").innerHTML = freq + " Hz";
            for (var ti = 0; ti < sec-increment; ti+=increment){ //200 sps, 3 sec
                var amplitude = Math.sin(2*Math.PI*freq*ti);
                //amplitude += Math.sin(2*Math.PI*300*ti); //Add 300Hz interference
                sineWave.push(amplitude);
                t.push(ti);
            }
            console.info(sineWave);

            var freqDom = frequencyDomain(sineWave,fs);
            
            console.info(freqDom);

            var fftdata = new ComplexArray(sineWave.length);
        
            /*
            fftdata.map((value,i) => {
                value.real = sineWave[i];
            });
            */
            //fftdata.FFT();
            //fftdata.InvFFT();
            fftdata.frequencyMap((value,i) => {
                value.real = sineWave[i];
            });
            console.info(fftdata);
            var amplitudeSpectrum = [];
            fftdata.forEach(function(item, idx) { //Extract amplitude spectrum. Must be mapped based on frequency.
                amplitudeSpectrum.push(Math.sqrt(Math.pow(item.real,2)+Math.pow(item.imag,2))); //sqrt(real^2 + imag^2) = amplitude
            });

            //dsp.js
            //var dspdata = new FFT(8192, fs);
            //dspdata.forward(sineWave);
            //console.info(dspdata);

            var data = [[{
              x: t,
              y: sineWave,
              type: 'line',
              marker: {
                color: "rgba(255,100,100, 1)"
              },
              name: "Sine",
              //xbins: {  size: 0.01  }
            }],[{
                x:freqDom[0],
                y:amplitudeSpectrum,
                type: 'line',
                marker: {
                    color: "rgba(100,255,100, 1)"
                },
                name: 'fftjs',    
                xbins: {  size: 1  }
            }],[{
                x:freqDom[0],
                y:freqDom[1],
                type: 'line',
                marker: {
                    color: "rgba(100,255,100, 1)"
                },
                name: 'homebrew',    
                xbins: {  size: 1  }
            }],[{
                x:freqDom[0],
                y:0, //dspdata.spectrum,
                type: 'line',
                marker: {
                    color: "rgba(100,255,100, 1)"
                },
                name: 'dspjs',    
                xbins: {  size: 1  }
            }]
            ];
            var config = { 
                scrollZoom: true, 
                responsive: true, 
            }
            Plotly.newPlot("chart",data[0],undefined,config);
            Plotly.newPlot("fftchart",data[1],undefined,config);
            Plotly.newPlot("homebrewfft",data[2],undefined,config);
            Plotly.newPlot("dspchart",data[3],undefined,config);

            //alert("Check console for result!");
            

        </script>
    </body>
</html>